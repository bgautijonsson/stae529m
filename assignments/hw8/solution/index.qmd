---
title: "Homework #8"
subtitle: "Exercise from Chapter 6.5: 4"
description: |
    **Assigned:** Friday, November 3rd, 2023 <br>
    **Due:** Friday, November 10th, 2023
author: 
    -   name: Brynjólfur Gauti Guðrúnar Jónsson
        email: brynjolfur@hi.is
        url: https://www.hi.is/staff/brynjolfur
        affiliation: 
        -   name: School of Engineering and Natural Sciences, University of Iceland
            city: Reykjavík
            url: https://english.hi.is/school_of_engineering_and_natural_sciences
# Change this to pdf if you'd rather work in that format
format: html 
editor: source
title-block-banner: true
#### The setting below makes our HTML document self-contained so that we can turn it in ####
#### UNCOMMENT THE LONE BELOW SO THAT YOU CAN TURN IN YOUR HTML DOCUMENT ###################
# embed-resources: true 
---

{{< downloadthis index.qmd dname="hw8_solution" label="Download the Quarto document used to render this file" type=primary class=downloadbutton >}}

```{r}
#| echo: fenced
#| output: hide
library(tidyverse)
library(ggplot2)
library(rjags)
library(posterior)
library(bayesplot)
library(gt)
library(DiagrammeR)
theme_set(theme_classic())
```


# 4

Download the marathon data of Section 6.4 from the course webpage. Let $Y_{ij}$ be the speed of runner $i$ in mile $j$. Fit the hierarchical model

$$
\begin{aligned}
Y_{i1} &\sim \mathrm{Normal}(\mu_i, \sigma_0^2) \\
Y_{ij} \vert Y_{ij-1} &\sim \mathrm{Normal}\left(\mu_i + \rho_i(Y_{ij-1} - \mu_i), \sigma_i^2\right) \\
\mu_i &\sim \mathrm{Normal}(\theta_1, \theta_2) \\
\rho_i &\sim \mathrm{Normal}(\theta_3, \theta_4) \\
\sigma_i^2 &\sim \mathrm{InvGamma}(\theta_5, \theta_6)
\end{aligned}
$$

```{r}
load(url("https://www4.stat.ncsu.edu/~bjreich/BSMdata/BostonMarathon2016.RData"))
```



a. Draw a DAG for this model and give an interpretation for each parameter in the model.

---

**Solution:**

```{dot}
digraph boxes_and_circles {

    # a 'graph' statement
    graph [overlap = true, fontsize = 10]

    theta1[label =<θ<sub>1</sub>>];
    theta2[label =<θ<sub>2</sub>>]; 
    theta3[label =<θ<sub>3</sub>>]; 
    theta4[label =<θ<sub>4</sub>>]; 
    theta5[label =<θ<sub>5</sub>>]; 
    theta6[label =<θ<sub>6</sub>>]; 
    mu[label = <μ>];
    rho[label = <ρ>];
    sigma1[label = <σ<sub>1</sub>>];
    sigmai[label = <σ<sub>i</sub>>];

    Yi1[label = <Y<sub>i1</sub>>]
    Yij[label = <Y<sub>ij</sub>>]
    
    # edge statements
    theta1->mu theta2->mu
    theta3->rho theta4-> rho
    theta5->sigma1 theta6->sigma1
    theta5->sigmai theta6->sigmai
    
    mu->Yi1 sigma1->Yi1
    
    mu->Yij sigmai->Yij rho->Yij Yij->Yij Yi1->Yij
}
```

---

b. Select uninformative prior distributions for $\theta_1, \dots, \theta_6$.

---

**Solution:**

---

c. Fit the model in `JAGS` using three chains each with 25,000 iterationsand thoroughly assess MCMC convergence for the $\theta_j$.

---

**Solution:**

---

d. Are the data informative about the $\theta_j$? That is, are the posterior distributions more concentrated than the prior distributions?

---

**Solution:**

---

e. In light of *c.* and *d.*, are there any simplifications you might consider and if so, how would you compare the full and simplified models?
