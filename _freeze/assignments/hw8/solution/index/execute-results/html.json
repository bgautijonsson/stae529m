{
  "hash": "674b94043457908ea7ebb98c8a33489a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Homework #8 (Solution)\"\nsubtitle: \"Exercise from Chapter 6.5: 4\"\ndescription: |\n    **Assigned:** Friday, November 3rd, 2023 <br>\n    **Due:** Friday, November 10th, 2023\nauthor: \n    -   name: Brynjólfur Gauti Guðrúnar Jónsson\n        email: brynjolfur@hi.is\n        url: https://www.hi.is/staff/brynjolfur\n        affiliation: \n        -   name: School of Engineering and Natural Sciences, University of Iceland\n            city: Reykjavík\n            url: https://english.hi.is/school_of_engineering_and_natural_sciences\n# Change this to pdf if you'd rather work in that format\nformat: html \neditor: source\ntitle-block-banner: true\n#### The setting below makes our HTML document self-contained so that we can turn it in ####\n#### UNCOMMENT THE LONE BELOW SO THAT YOU CAN TURN IN YOUR HTML DOCUMENT ###################\n# embed-resources: true \n---\n\n{{< downloadthis index.qmd dname=\"hw8_solution\" label=\"Download the Quarto document used to render this file\" type=primary class=downloadbutton >}}\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| output: hide\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(rjags)\nlibrary(posterior)\nlibrary(bayesplot)\nlibrary(gt)\ntheme_set(theme_classic())\n```\n````\n:::\n\n\n\n# 4\n\nDownload the marathon data of Section 6.4 from the course webpage. Let $Y_{ij}$ be the speed of runner $i$ in mile $j$. Fit the hierarchical model\n\n$$\n\\begin{aligned}\nY_{i1} &\\sim \\mathrm{Normal}(\\mu_i, \\sigma_0^2) \\\\\nY_{ij} \\vert Y_{ij-1} &\\sim \\mathrm{Normal}\\left(\\mu_i + \\rho_i(Y_{ij-1} - \\mu_i), \\sigma_i^2\\right) \\\\\n\\mu_i &\\sim \\mathrm{Normal}(\\theta_1, \\theta_2) \\\\\n\\rho_i &\\sim \\mathrm{Normal}(\\theta_3, \\theta_4) \\\\\n\\sigma_i^2 &\\sim \\mathrm{InvGamma}(\\theta_5, \\theta_6)\n\\end{aligned}\n$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nload(url(\"https://www4.stat.ncsu.edu/~bjreich/BSMdata/BostonMarathon2016.RData\"))\n```\n:::\n\n\n\n\na. Draw a DAG for this model and give an interpretation for each parameter in the model.\n\n---\n\n**Solution:**\n\n\n```{dot}\ndigraph boxes_and_circles {\n\n# a 'graph' statement\ngraph [overlap = true, fontsize = 10]\n\ntheta1[label =<θ<sub>1</sub>>];\ntheta2[label =<θ<sub>2</sub>>]; \ntheta3[label =<θ<sub>3</sub>>]; \ntheta4[label =<θ<sub>4</sub>>]; \ntheta5[label =<θ<sub>5</sub>>]; \ntheta6[label =<θ<sub>6</sub>>]; \nmu[label = <μ<sub>i</sub>>];\nrho[label = <ρ<sub>i</sub>>];\nsigma1[label = <σ<sub>0</sub>>];\nsigmai[label = <σ<sub>i</sub>>];\n\nYi1[label = <Y<sub>i1</sub>>]\nYij[label = <Y<sub>ij</sub>>]\n\n# edge statements\ntheta1->mu theta2->mu\ntheta3->rho theta4-> rho\ntheta5->sigma1 theta6->sigma1\ntheta5->sigmai theta6->sigmai\n\nmu->Yi1 sigma1->Yi1\n\nmu->Yij sigmai->Yij rho->Yij Yij->Yij Yi1->Yij\n}\n```\n\n\n---\n\nb. Select uninformative prior distributions for $\\theta_1, \\dots, \\theta_6$.\n\n---\n\n**Solution:**\n\nSince $\\theta_1$ and $\\theta_3$ are both parameters for the mean of normal distributions, it makes sense to give them normal priors. To make them uninformative we can give them large variances, such as for example\n\n$$\n\\theta_1, \\theta_3 \\sim \\mathrm{Normal}(0, 100).\n$$\n\n$\\theta_2$ and $\\theta_4$ are both variances in normal distributions, so we could give them Inverse Gamma priors. To make them uninformative we make the prior variance high, for example\n\n$$\n\\theta_2, \\theta_4 \\sim \\mathrm{InvGamma}(0.01, 0.01)\n$$\n\n$\\theta_5$ and $\\theta_6$ are the shape and scale parameters in an Inverse Gamma distribution. We know that they are both positive and unbounded, so we could for example give them both Gamma priors with high variance, for example\n\n$$\n\\theta_5, \\theta_6 \\sim \\mathrm{Gamma}(0.1, 0.1)\n$$\n\n---\n\nc. Fit the model in `JAGS` using three chains each with 25,000 iterations and thoroughly assess MCMC convergence for the $\\theta_j$.\n\n---\n\n**Solution:**\n\nFirst we prepare the data. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nmen <- Marathon_male$SPEED_mile |> \n    as_tibble() |> \n    rownames_to_column(\"runner\") |> \n    pivot_longer(c(-runner), names_to = \"mile\", values_to = \"speed\") |> \n    mutate(\n        mile = parse_number(mile),\n        runner = parse_number(runner)\n    )\n\nwomen <- Marathon_female$SPEED_mile |> \n    as_tibble() |> \n    rownames_to_column(\"runner\") |> \n    pivot_longer(c(-runner), names_to = \"mile\", values_to = \"speed\") |> \n    mutate(\n        mile = parse_number(mile),\n        runner = parse_number(runner),\n        runner = runner + max(men$runner)\n    )\n\nd <- bind_rows(men, women)\n\nY <- rbind(Marathon_male$SPEED_mile, Marathon_female$SPEED_mile)\n\njags_data <- list(\n    N_obs = ncol(Y),\n    N_runners = nrow(Y),\n    Y = Y\n)\n```\n:::\n\n\nThen we code the model and sample from its posterior.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-5_8efe9e7cfb5d1438ccd08456f050351d'}\n\n```{.r .cell-code}\nmodel_string <- textConnection(\"model{\n    \n    for (i in 1:N_runners) {\n        mu[i] ~ dnorm(theta[1], inv_theta2)\n        rho[i] ~ dnorm(theta[3], inv_theta4)\n        tau[i] ~ dgamma(theta[5], theta[6])\n        sigma[i] <- pow(tau[i], -1)\n        Y[i, 1] ~ dnorm(mu[i], tau0)\n    \n        for (j in 2:N_obs) {\n            Y[i, j] ~ dnorm(mu[i] + rho[i] * (Y[i, j - 1] - mu[i]), tau[i])\n        }\n    }\n    \n    tau0 ~ dgamma(theta[5], theta[6])\n    sigma0 <- pow(tau0, -1)\n    \n    theta[1] ~ dnorm(0, 0.0001)\n    theta[3] ~ dnorm(0, 0.0001)\n    \n    inv_theta2 ~ dgamma(0.001, 0.001)\n    theta[2] <- pow(inv_theta2, -1)\n    inv_theta4 ~ dgamma(0.001, 0.001)\n    theta[4] <- pow(inv_theta4, -1)\n    \n    theta[5] ~ dgamma(0.001, 0.001)\n    theta[6] ~ dgamma(0.001, 0.001)\n    \n    \n}\")\n\nmodel <- jags.model(\n    model_string,\n    jags_data,\n    n.chains = 3\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCompiling model graph\n   Resolving undeclared variables\n   Allocating nodes\nGraph information:\n   Observed stochastic nodes: 6276\n   Unobserved stochastic nodes: 1097\n   Total graph size: 25586\n\nInitializing model\n```\n\n\n:::\n\n```{.r .cell-code}\nupdate(model, 10000)\n\nsamples <- coda.samples(\n  model,\n  variable.names = c(\"mu\", \"sigma\", \"tau\", \"rho\", \"theta\", \"sigma0\", \"Y[5,11]\", \"Y[5,12]\", \"Y[5,13]\"),\n  n.iter = 25000\n)\n\nposterior_jags <- samples |> \n  as_draws_df()\n```\n:::\n\n\nThe table and trace plots below show us that the chains seem to have converged. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_jags |> \n    subset_draws(variable = \"theta\") |> \n    summarise_draws(rhat, ess_bulk, ess_tail) |> \n    gt() |> \n    fmt_number()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"udtsujoypr\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#udtsujoypr table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#udtsujoypr thead, #udtsujoypr tbody, #udtsujoypr tfoot, #udtsujoypr tr, #udtsujoypr td, #udtsujoypr th {\n  border-style: none;\n}\n\n#udtsujoypr p {\n  margin: 0;\n  padding: 0;\n}\n\n#udtsujoypr .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#udtsujoypr .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#udtsujoypr .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#udtsujoypr .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#udtsujoypr .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#udtsujoypr .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#udtsujoypr .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#udtsujoypr .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#udtsujoypr .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#udtsujoypr .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#udtsujoypr .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#udtsujoypr .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#udtsujoypr .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#udtsujoypr .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#udtsujoypr .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#udtsujoypr .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#udtsujoypr .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#udtsujoypr .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#udtsujoypr .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#udtsujoypr .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#udtsujoypr .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#udtsujoypr .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#udtsujoypr .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#udtsujoypr .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#udtsujoypr .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#udtsujoypr .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#udtsujoypr .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#udtsujoypr .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#udtsujoypr .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#udtsujoypr .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#udtsujoypr .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#udtsujoypr .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#udtsujoypr .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#udtsujoypr .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#udtsujoypr .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#udtsujoypr .gt_left {\n  text-align: left;\n}\n\n#udtsujoypr .gt_center {\n  text-align: center;\n}\n\n#udtsujoypr .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#udtsujoypr .gt_font_normal {\n  font-weight: normal;\n}\n\n#udtsujoypr .gt_font_bold {\n  font-weight: bold;\n}\n\n#udtsujoypr .gt_font_italic {\n  font-style: italic;\n}\n\n#udtsujoypr .gt_super {\n  font-size: 65%;\n}\n\n#udtsujoypr .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#udtsujoypr .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#udtsujoypr .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#udtsujoypr .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#udtsujoypr .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#udtsujoypr .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#udtsujoypr .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"variable\">variable</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"rhat\">rhat</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ess_bulk\">ess_bulk</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ess_tail\">ess_tail</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">theta[1]</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">32,069.71</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">66,128.52</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">theta[2]</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">36,511.81</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">52,096.65</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">theta[3]</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">8,356.18</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">19,985.41</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">theta[4]</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">3,403.53</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">6,340.33</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">theta[5]</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">6,853.46</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">14,393.68</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">theta[6]</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">7,346.81</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">15,732.06</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_jags |> \n    mcmc_trace(\n        regex_pars = \"theta\"\n    )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n---\n\nd. Are the data informative about the $\\theta_j$? That is, are the posterior distributions more concentrated than the prior distributions?\n\n---\n\n**Solution:**\n\nTo check whether the daa are informative, we compare the prior variance of each $\\theta_j$ to its posterior variance. If the posterior variance is much smaller than the prior variance we can conclude that the data are informative for the parameter\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsds <- posterior_jags |> \n    subset_draws(variable = \"theta\") |> \n    summarise_draws() |> \n    pull(sd) |> \n    as.numeric()\n    \ntribble(\n    ~theta, ~prior_variance,\n    \"theta[1]\", 100,\n    \"theta[2]\", Inf,\n    \"theta[3]\", 100,\n    \"theta[4]\", Inf,\n    \"theta[5]\", 1000,\n    \"theta[6]\", 1000\n) |> \n    mutate(\n        posterior_variance = sds^2\n    )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 3\n  theta    prior_variance posterior_variance\n  <chr>             <dbl>              <dbl>\n1 theta[1]            100        0.00115    \n2 theta[2]            Inf        0.000653   \n3 theta[3]            100        0.0000259  \n4 theta[4]            Inf        0.000000272\n5 theta[5]           1000        0.0189     \n6 theta[6]           1000        0.00000669 \n```\n\n\n:::\n:::\n\n\n\n---\n\ne. In light of *c.* and *d.*, are there any simplifications you might consider and if so, how would you compare the full and simplified models?\n\nIn addition to the results from *c.* and *d.*, we can also look at the marginal densities of each $\\theta_j$. In the figure below, we see that $\\theta_4$, the variance of the normal distribution from which we draw $\\rho_i$ is very small in comparison to $\\theta_3$ the mean of the normal distribution.\n\nOur results from *c.* tell us that this parameter is well estimated.\n\nThe results in *d.* tell us that our priors aren't artificially making this posterior density narrow.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_jags |> \n    mcmc_dens(\n        regex_pars = \"theta\"\n    )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nWe could thus consider simplifying our model by using one $\\rho$ parameter that is shared by all the participants. Looking at the figure of the posterior density of each $\\rho_i$, it seems like this might work for most participants, but there are some $\\rho_i$ that seem to be different from the rest.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-10_8eaa01298f0aafbdce65c0b0b46e37b0'}\n\n```{.r .cell-code}\nplot_dat <- posterior_jags |> \n  subset_draws(\"rho\") |> \n  summarise_draws()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_dat |> \n  mutate(\n    id = parse_number(variable)\n  ) |> \n  ggplot(aes(id, mean, ymin = q5, ymax = q95)) +\n  geom_pointrange(\n    linewidth = 0.5,\n    size = 0.5\n  ) +\n  coord_flip() +\n  labs(\n    x = \"Individual\",\n    y = expression(rho[i]),\n    title = expression(paste(\"Individual-specific \", rho[i], \" estimates\")),\n    subtitle = \"Posterior mean and 95% credible intervals\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}