{
  "hash": "4b2f1439e689c56fbbf1f281b68103eb",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Homework #6 (Solution)\"\nsubtitle: \"Exercises from Chapter 4.6: 4, 7 and 8\"\ndescription: |\n    **Assigned:** Friday, October 6th, 2023 <br>\n    **Due:** Friday, October 20th, 2023\nauthor: \n    -   name: Brynjólfur Gauti Guðrúnar Jónsson\n        email: brynjolfur@hi.is\n        url: https://www.hi.is/staff/brynjolfur\n        affiliation: \n        -   name: School of Engineering and Natural Sciences, University of Iceland\n            city: Reykjavík\n            url: https://english.hi.is/school_of_engineering_and_natural_sciences\n# Change this to pdf if you'd rather work in that format\nformat: html \neditor: source\ntitle-block-banner: true\n#### The setting below makes our HTML document self-contained so that we can turn it in ####\n#### UNCOMMENT THE LONE BELOW SO THAT YOU CAN TURN IN YOUR HTML DOCUMENT ###################\n# embed-resources: true \n---\n\n{{< downloadthis index.qmd dname=\"hw6_solution\" label=\"Download the Quarto document used to render this file\" type=primary class=downloadbutton >}}\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r setup}}\n#| output: hide\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(rjags)\nlibrary(posterior)\nlibrary(bayesplot)\nlibrary(gt)\ntheme_set(theme_classic())\n```\n````\n:::\n\n\n\n# 4\n\nDownload the US gun control data from the book's website. For state $i$, let $Y_i$ be the number of homicides and $N_i$ be the population.\n\na. Fit the model $Y_i \\vert \\beta \\sim \\mathrm{Poisson}(N_i\\lambda_i)$ where $\\log(\\lambda_i) = \\mathbf X_i\\beta$. Use uninformative priors and $p = 7$ covariates in $\\mathbf X_i$: the intercept, the five confounders $\\mathbf Z_i$, and the total number of gun laws in state $i$. Provide justification that the MCMC sampler has converged and sufficiently explored the posterior distribution and summarize the posterior of $\\beta$\n\n---\n\n**Solution:**\n\n---\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-1_bb8afd39175b95a2af30e01e432fac4b'}\n\n```{.r .cell-code}\nload(url(\"https://www4.stat.ncsu.edu/~bjreich/BSMdata/guns.RData\",))\n\n\nGunLaws <- rowSums(X)\nmy_X <- cbind(Z, GunLaws) |> scale()\n\nmodel_string <- textConnection(\"model{\n    # Likelihood\n    for (i in 1:N_obs) {\n        Y[i] ~ dpois(N[i] * lambda[i])\n        log(lambda[i]) <- alpha + (X[i, ] %*% beta)\n    }\n    for (j in 1:6) {\n        beta[j] ~ dnorm(0, 0.1)\n    }\n    \n    alpha ~ dnorm(0, 0.1)\n}\")\n\ndata = list(\n  X = my_X,\n  N = N,\n  Y = Y,\n  N_obs = length(Y)\n)\n\nmodel <- jags.model(\n  model_string,\n  data = data,\n  n.chains = 4,\n  quiet = TRUE\n)\n\nupdate(model, 10000, progress.bar = \"none\")\n\n\nsamples <- coda.samples(\n  model,\n  variable.names = c(\"alpha\", \"beta\"),\n  n.iter = 10000,\n  progress.bar = \"none\"\n)\n\nposterior_jags <- samples |> \n  as_draws_df()\n```\n:::\n\n\nThe table below shows us that the $\\hat R$ and ESS of our variables is sufficiently low and the trace plot shows no signs of a lack of convergence. The table below also shows a summary of the posterior distrubution of each model parameter.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_jags |> \n  summarise_draws() |> \n  gt() |> \n  fmt_number(\n    decimals = 2\n  ) \n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"umouhgojvt\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#umouhgojvt table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#umouhgojvt thead, #umouhgojvt tbody, #umouhgojvt tfoot, #umouhgojvt tr, #umouhgojvt td, #umouhgojvt th {\n  border-style: none;\n}\n\n#umouhgojvt p {\n  margin: 0;\n  padding: 0;\n}\n\n#umouhgojvt .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#umouhgojvt .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#umouhgojvt .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#umouhgojvt .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#umouhgojvt .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#umouhgojvt .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#umouhgojvt .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#umouhgojvt .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#umouhgojvt .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#umouhgojvt .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#umouhgojvt .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#umouhgojvt .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#umouhgojvt .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#umouhgojvt .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#umouhgojvt .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#umouhgojvt .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#umouhgojvt .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#umouhgojvt .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#umouhgojvt .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#umouhgojvt .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#umouhgojvt .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#umouhgojvt .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#umouhgojvt .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#umouhgojvt .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#umouhgojvt .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#umouhgojvt .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#umouhgojvt .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#umouhgojvt .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#umouhgojvt .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#umouhgojvt .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#umouhgojvt .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#umouhgojvt .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#umouhgojvt .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#umouhgojvt .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#umouhgojvt .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#umouhgojvt .gt_left {\n  text-align: left;\n}\n\n#umouhgojvt .gt_center {\n  text-align: center;\n}\n\n#umouhgojvt .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#umouhgojvt .gt_font_normal {\n  font-weight: normal;\n}\n\n#umouhgojvt .gt_font_bold {\n  font-weight: bold;\n}\n\n#umouhgojvt .gt_font_italic {\n  font-style: italic;\n}\n\n#umouhgojvt .gt_super {\n  font-size: 65%;\n}\n\n#umouhgojvt .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#umouhgojvt .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#umouhgojvt .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#umouhgojvt .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#umouhgojvt .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#umouhgojvt .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#umouhgojvt .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"variable\">variable</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"mean\">mean</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"median\">median</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"sd\">sd</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"mad\">mad</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"q5\">q5</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"q95\">q95</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"rhat\">rhat</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ess_bulk\">ess_bulk</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ess_tail\">ess_tail</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">alpha</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">−9.16</td>\n<td headers=\"median\" class=\"gt_row gt_right\">−9.16</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−9.18</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">−9.15</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">13,414.48</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">18,958.25</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">beta[1]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">0.32</td>\n<td headers=\"median\" class=\"gt_row gt_right\">0.32</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">0.30</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">0.35</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">3,778.12</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">7,256.56</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">beta[2]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">−0.05</td>\n<td headers=\"median\" class=\"gt_row gt_right\">−0.05</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−0.06</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">−0.03</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">5,682.28</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">10,585.90</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">beta[3]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">0.02</td>\n<td headers=\"median\" class=\"gt_row gt_right\">0.02</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">0.03</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">12,427.16</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">16,946.11</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">beta[4]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">−0.01</td>\n<td headers=\"median\" class=\"gt_row gt_right\">−0.01</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−0.02</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">6,439.86</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">11,669.08</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">beta[5]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">0.00</td>\n<td headers=\"median\" class=\"gt_row gt_right\">0.00</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−0.01</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">8,774.36</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">14,705.81</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">beta[6]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">−0.08</td>\n<td headers=\"median\" class=\"gt_row gt_right\">−0.08</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−0.09</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">−0.06</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">6,892.82</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">12,702.51</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmcmc_trace(\n  posterior_jags\n)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nb. Fit a Negative binomial regression model and compare with the results from Poisson regression.\n\n---\n\n**Solution:**\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-4_c47e24678da7de131938308f221e4a7d'}\n\n```{.r .cell-code}\nmodel_string <- textConnection(\"model{\n    # Likelihood\n    for (i in 1:N_obs) {\n        Y[i] ~ dnegbin(q[i], m)\n        q[i] <- m / (m + N[i] * lambda[i])\n        log(lambda[i]) <- alpha + inprod(X[i, ], beta[])\n    }\n    for (j in 1:6) {\n        beta[j] ~ dnorm(0, 0.0001)\n    }\n    \n    alpha ~ dnorm(0, 0.0001)\n    m ~ dgamma(0.1, 0.1)\n}\")\n\ndata = list(\n  X = my_X,\n  N = N,\n  Y = Y,\n  N_obs = length(Y)\n)\n\nmodel <- jags.model(\n  model_string,\n  data = data,\n  n.chains = 4,\n  quiet = TRUE\n)\n\nupdate(model, 10000, progress.bar = \"none\")\n\n\nsamples <- coda.samples(\n  model,\n  variable.names = c(\"alpha\", \"beta\", \"m\"),\n  n.iter = 10000,\n  progress.bar = \"none\"\n)\n\nposterior_jags <- samples |> \n  as_draws_df()\n```\n:::\n\n\nThe table below shows us that the $\\hat R$ and ESS of our variables is sufficiently low and the trace plot shows no signs of a lack of convergence. The table below also shows a summary of the posterior distrubution of each model parameter.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_jags |> \n  summarise_draws() |> \n  mutate(\n    plot_col = 1\n  ) |> \n  gt() |> \n  fmt_number(\n    decimals = 2\n  ) \n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"resplipdtl\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#resplipdtl table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#resplipdtl thead, #resplipdtl tbody, #resplipdtl tfoot, #resplipdtl tr, #resplipdtl td, #resplipdtl th {\n  border-style: none;\n}\n\n#resplipdtl p {\n  margin: 0;\n  padding: 0;\n}\n\n#resplipdtl .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#resplipdtl .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#resplipdtl .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#resplipdtl .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#resplipdtl .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#resplipdtl .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#resplipdtl .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#resplipdtl .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#resplipdtl .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#resplipdtl .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#resplipdtl .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#resplipdtl .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#resplipdtl .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#resplipdtl .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#resplipdtl .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#resplipdtl .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#resplipdtl .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#resplipdtl .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#resplipdtl .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#resplipdtl .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#resplipdtl .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#resplipdtl .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#resplipdtl .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#resplipdtl .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#resplipdtl .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#resplipdtl .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#resplipdtl .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#resplipdtl .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#resplipdtl .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#resplipdtl .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#resplipdtl .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#resplipdtl .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#resplipdtl .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#resplipdtl .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#resplipdtl .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#resplipdtl .gt_left {\n  text-align: left;\n}\n\n#resplipdtl .gt_center {\n  text-align: center;\n}\n\n#resplipdtl .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#resplipdtl .gt_font_normal {\n  font-weight: normal;\n}\n\n#resplipdtl .gt_font_bold {\n  font-weight: bold;\n}\n\n#resplipdtl .gt_font_italic {\n  font-style: italic;\n}\n\n#resplipdtl .gt_super {\n  font-size: 65%;\n}\n\n#resplipdtl .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#resplipdtl .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#resplipdtl .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#resplipdtl .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#resplipdtl .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#resplipdtl .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#resplipdtl .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"variable\">variable</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"mean\">mean</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"median\">median</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"sd\">sd</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"mad\">mad</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"q5\">q5</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"q95\">q95</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"rhat\">rhat</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ess_bulk\">ess_bulk</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ess_tail\">ess_tail</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"plot_col\">plot_col</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">alpha</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">−9.16</td>\n<td headers=\"median\" class=\"gt_row gt_right\">−9.17</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.02</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.02</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−9.19</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">−9.14</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">24,306.41</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">23,025.54</td>\n<td headers=\"plot_col\" class=\"gt_row gt_right\">1.00</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">beta[1]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">0.31</td>\n<td headers=\"median\" class=\"gt_row gt_right\">0.31</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.04</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.04</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">0.24</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">0.37</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">4,224.12</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">7,457.87</td>\n<td headers=\"plot_col\" class=\"gt_row gt_right\">1.00</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">beta[2]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">−0.04</td>\n<td headers=\"median\" class=\"gt_row gt_right\">−0.04</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.03</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.03</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−0.09</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">0.00</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">7,980.91</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">13,916.39</td>\n<td headers=\"plot_col\" class=\"gt_row gt_right\">1.00</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">beta[3]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"median\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.02</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.02</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−0.03</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">0.04</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">13,979.67</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">19,509.81</td>\n<td headers=\"plot_col\" class=\"gt_row gt_right\">1.00</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">beta[4]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"median\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.03</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.03</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−0.03</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">0.05</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">7,132.44</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">13,483.43</td>\n<td headers=\"plot_col\" class=\"gt_row gt_right\">1.00</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">beta[5]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"median\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.03</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.03</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−0.03</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">0.05</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">9,036.48</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">14,989.34</td>\n<td headers=\"plot_col\" class=\"gt_row gt_right\">1.00</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">beta[6]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">−0.10</td>\n<td headers=\"median\" class=\"gt_row gt_right\">−0.10</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.03</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.03</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−0.14</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">−0.06</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">7,125.51</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">11,216.85</td>\n<td headers=\"plot_col\" class=\"gt_row gt_right\">1.00</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">m</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">88.50</td>\n<td headers=\"median\" class=\"gt_row gt_right\">86.20</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">22.80</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">21.92</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">55.31</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">129.51</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">15,875.78</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">17,765.77</td>\n<td headers=\"plot_col\" class=\"gt_row gt_right\">1.00</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmcmc_trace(\n  posterior_jags\n)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\nc. For the Poisson model in (a), compute the posterior predictive distribution for each state with the number of gun laws set to zero. Repeat this with the number of gun laws set to 25 (the maximum number). According to these calculations, how would the number of deaths nationwide be affected by these policy changes? Do you trust these projections?\n\n---\n\n**Solution:**\n\nHere it is important to keep in mind that if we scale the original X predictors, we need to apply the same scaling to the new values we use for 0 or 25 gun laws, i.e.\n\n$$\n0_{\\mathrm{scaled}} = \\frac{0 - \\mathrm{mean}(X)}{ \\mathrm{SD}(X)}\n$$\n\nand\n\n$$\n25_{\\mathrm{scaled}} = \\frac{25 - \\mathrm{mean}(X)}{ \\mathrm{SD}(X)}\n$$\n\nwhere X is a vector containing the number of gun laws in each state.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-7_d97e231e49f0b7c15cab67b6570dec2b'}\n\n```{.r .cell-code}\nmean_gunlaws <- mean(GunLaws)\nsd_gunlaws <- sd(GunLaws)\n\nscaled_zero <- (0 - mean_gunlaws) / sd_gunlaws\nscaled_25 <- (25 - mean_gunlaws) / sd_gunlaws\n\ndata = list(\n  X = my_X,\n  scaled_zero = scaled_zero,\n  scaled_25 = scaled_25,\n  N = N,\n  Y = Y,\n  N_obs = length(Y)\n)\n\nmodel_string <- textConnection(\"model{\n    # Likelihood\n    for (i in 1:N_obs) {\n        Y[i] ~ dnegbin(q[i], m)\n        q[i] <- m / (m + N[i] * lambda[i])\n        log(lambda[i]) <- alpha + inprod(X[i, ], beta[])\n    \n        Y0[i] ~ dnegbin(q0[i], m)\n        q0[i] <- m / (m + N[i] * lambda0[i])\n        log(lambda0[i]) <- alpha + inprod(X[i, 1:5], beta[1:5]) + scaled_zero * beta[6]\n    \n        Y25[i] ~ dnegbin(q25[i], m)\n        q25[i] <- m / (m + N[i] * lambda25[i])\n        log(lambda25[i]) <- alpha + inprod(X[i, 1:5], beta[1:5]) + scaled_25 * beta[6]\n        \n    }\n    for (j in 1:6) {\n        beta[j] ~ dnorm(0, 0.0001)\n    }\n    \n    national_difference <- sum(Y25 - Y0)\n    alpha ~ dnorm(0, 0.0001)\n    m ~ dgamma(0.1, 0.1)\n}\")\n\nmodel <- jags.model(\n  model_string,\n  data = data,\n  n.chains = 4,\n  quiet = TRUE\n)\n\nupdate(model, 10000, progress.bar = \"none\")\n\n\nsamples <- coda.samples(\n  model,\n  variable.names = c(\"national_difference\"),\n  n.iter = 10000,\n  progress.bar = \"none\"\n)\n```\n:::\n\n\nThe plot below shows the posterior distribution of the nation-wide reduction in homicides when all counties implement all 25 gun laws, versus if all counties implement zero gun laws. We see that 98% of the posterior mass lies beneath 0, so the model still estimates a 2% chance that implementing all gun laws will not reduce homicides by a measurable amount.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples |> \n  as_draws_df() |> \n  subset_draws(variable = \"national_difference\") |> \n  summarise_draws(\"P(x < 0)\" = function(x) mean(x < 0))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 2\n  variable            `P(x < 0)`\n  <chr>                    <num>\n1 national_difference       1.00\n```\n\n\n:::\n:::\n\n\nThe plot below shows the posterior distribution of the reduction in homicides.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples |> \n  mcmc_areas(\n    pars = \"national_difference\",\n    prob = 0.95,\n    prob_outer = 1\n  ) +\n  labs(\n    title = \"Posterior distribution of reduction in homicides\",\n    subtitle = \"The blue area is a 95% credible interval for the reduction in total deaths\\nif all counties implemented all 25 gun laws versus 0 gun laws\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n\n---\n\n\n\n---\n\n# 7\n\nConsider the one-way random effects model\n\n$$\nY_{ij} \\vert \\alpha_i, \\sigma^2 \\sim \\mathrm{Normal}(\\alpha_i, \\sigma^2)\n$$\n\nand\n\n$$\n\\alpha_i \\sim \\mathrm{Normal}(0, \\tau^2)\n$$\n\nfor $i = 1, \\dots, n$ and $j = 1, \\dots, m$. Assuming conjugate priors $\\sigma^2, \\tau^2 \\sim \\mathrm{InvGamma}(a, b)$ derive the full conditional distributions of $\\alpha_1$, $\\sigma^2$ and $\\tau^2$ and outline (but do not code) an MCMC algorithm to sample from the posterior.\n\n---\n\n**Solution:**\n\n$$\n\\begin{aligned}\n\\alpha_j \\vert rest &\\sim \\mathrm{Normal}\\left( \\frac{\\sum_{i=1}^n Y_{ij}}{n + \\sigma^2/\\tau^2}, \\frac{\\sigma^2}{n + \\sigma^2/\\tau^2}\\right) \\\\\n\\sigma^2 \\vert rest &\\sim \\mathrm{InvGamma}\\left(nm/2 + a, \\sum_{i=1}^{n} \\sum_{j=1}^{m}(Y_{ij} - a)^2/2 + b\\right) \\\\\n\\tau^2\\vert rest &\\sim \\mathrm{InvGamma}\\left(m/2+a, \\sum_{j=1}^{m}\\alpha^2_j/2 + b\\right)\n\\end{aligned}\n$$\n\nTo implement the Gibbs sampler we first choose initial values for the parameters, then we go through the parameters sequentially and sample from their full conditional distributions outlined above.\n\n---\n\n\n\n# 8\n\nLoad the `gambia` data from the `geoR` package in `R`. The response variable $Y_i$ is the binary indicator that child $i$ tested positive for malaria (`pos`) and the remaining seven variables are covariates.\n\na. Fit the logistic regression model\n\n$$\n\\mathrm{logit[Prob(Y_i=1)]} = \\sum_{j=1}^p X_{ij}\\beta_j\n$$\n\nwith uninformative priors for the $\\beta_j$. Verify that the MCMC sampler has converged and summarize the effects of the covariates.\n\n---\n\n**Solution:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(gambia, package = \"geoR\")\nY <- gambia$pos\n\nX <- gambia |> select(-pos) |> as.matrix() |> scale()\n\ndata <- list(\n  Y = Y, \n  N_obs = length(Y),\n  P = ncol(X), \n  X = X\n)\n\nmodel_string <- textConnection(\"model{\n  #likelihood\n  for(i in 1:N_obs){\n    Y[i] ~ dbern(p[i])\n    logit(p[i]) <- alpha + inprod(X[i,], beta[])\n  }\n  #priors\n  for(j in 1:P) {\n    beta[j] ~ dnorm(0, 0.01)\n  }\n  \n  alpha ~ dnorm(0, 0.0001)\n}\")\n\n\n# model <- jags.model(model_string, data = data, n.chains = 2, )\n# update(model, 5000)\n# samples <- coda.samples(model, variable.names = c(\"alpha\", \"beta\"), thin = 1, n.iter = 5000)\n# \n# write_rds(samples, \"8a_samples.rds\")\n\nsamples <- read_rds(\"8a_samples.rds\")\n```\n:::\n\n\nThe table below shows us that the $\\hat R$ of our variables is sufficiently low and the trace plot shows no signs of a lack of convergence.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples |> \n  summarise_draws() |> \n  gt() |> \n  fmt_number()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"xxzozadziw\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#xxzozadziw table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#xxzozadziw thead, #xxzozadziw tbody, #xxzozadziw tfoot, #xxzozadziw tr, #xxzozadziw td, #xxzozadziw th {\n  border-style: none;\n}\n\n#xxzozadziw p {\n  margin: 0;\n  padding: 0;\n}\n\n#xxzozadziw .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#xxzozadziw .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#xxzozadziw .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#xxzozadziw .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#xxzozadziw .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#xxzozadziw .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xxzozadziw .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#xxzozadziw .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#xxzozadziw .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#xxzozadziw .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#xxzozadziw .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#xxzozadziw .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#xxzozadziw .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#xxzozadziw .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#xxzozadziw .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#xxzozadziw .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#xxzozadziw .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#xxzozadziw .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#xxzozadziw .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xxzozadziw .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#xxzozadziw .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#xxzozadziw .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#xxzozadziw .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xxzozadziw .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#xxzozadziw .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#xxzozadziw .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xxzozadziw .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xxzozadziw .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#xxzozadziw .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xxzozadziw .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#xxzozadziw .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xxzozadziw .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#xxzozadziw .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xxzozadziw .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#xxzozadziw .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xxzozadziw .gt_left {\n  text-align: left;\n}\n\n#xxzozadziw .gt_center {\n  text-align: center;\n}\n\n#xxzozadziw .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#xxzozadziw .gt_font_normal {\n  font-weight: normal;\n}\n\n#xxzozadziw .gt_font_bold {\n  font-weight: bold;\n}\n\n#xxzozadziw .gt_font_italic {\n  font-style: italic;\n}\n\n#xxzozadziw .gt_super {\n  font-size: 65%;\n}\n\n#xxzozadziw .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#xxzozadziw .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#xxzozadziw .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#xxzozadziw .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#xxzozadziw .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#xxzozadziw .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#xxzozadziw .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"variable\">variable</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"mean\">mean</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"median\">median</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"sd\">sd</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"mad\">mad</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"q5\">q5</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"q95\">q95</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"rhat\">rhat</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ess_bulk\">ess_bulk</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ess_tail\">ess_tail</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">beta[1]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">0.38</td>\n<td headers=\"median\" class=\"gt_row gt_right\">0.38</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.09</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.09</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">0.23</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">0.53</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">892.38</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">1,605.03</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">beta[2]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">−0.34</td>\n<td headers=\"median\" class=\"gt_row gt_right\">−0.34</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.05</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.05</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−0.42</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">−0.25</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">4,283.74</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">5,481.87</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">beta[3]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">0.27</td>\n<td headers=\"median\" class=\"gt_row gt_right\">0.27</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.05</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.05</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">0.19</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">0.35</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">6,049.84</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">5,459.74</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">beta[4]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">−0.32</td>\n<td headers=\"median\" class=\"gt_row gt_right\">−0.32</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.05</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.05</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−0.40</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">−0.23</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">3,965.28</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">4,987.25</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">beta[5]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">−0.02</td>\n<td headers=\"median\" class=\"gt_row gt_right\">−0.02</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.06</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.06</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−0.12</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">0.09</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">2,897.16</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">4,790.87</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">beta[6]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">−0.02</td>\n<td headers=\"median\" class=\"gt_row gt_right\">−0.02</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.09</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.09</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−0.18</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">0.13</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">879.93</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">1,753.36</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">beta[7]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">−0.20</td>\n<td headers=\"median\" class=\"gt_row gt_right\">−0.20</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.05</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.06</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−0.29</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">−0.11</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">3,137.29</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">4,538.17</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples |> \n  mcmc_trace()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\n---\n\nb. In this dataset, the 2035 children reside in $L = 65$ unique locations (defined by the x and y coordinates in the dataset). Let $s_i \\in \\{1, \\dots, L\\}$ be the label of the location for observation $i$. Fit the random effects logistic regression model\n\n$$\n\\begin{gathered}\n\\mathrm{logit[Prob(Y_i=1)]} = \\sum_{j=1}^p X_{ij}\\beta_j + \\alpha_{s_i} \\\\\n\\alpha_l \\sim \\mathrm{Normal}(0, \\tau^2)\n\\end{gathered}\n$$\n\nand the $\\beta_j$ and $\\tau^2$ have uninformative priors. Verify that the MCMC sampler has converged; explain why random effects might be needed here; discuss and explain any differences in the posteriors of the regression coefficients that occur when random effects are added to the model; plot the posterior means of the $\\alpha_l$ by their spatial locations and suggest how this map might be useful to malaria researchers.\n\n---\n\n**Solution:**\n\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nloc <- gambia |> group_by(x, y) |> mutate(id = cur_group_id()) |> pull(id)\n# \n# data <- list(\n#   Y = Y, \n#   N_obs = length(Y),\n#   P = ncol(X), \n#   X = X,\n#   loc = loc,\n#   N_locations = max(loc)\n# )\n# \n# model_string <- textConnection(\"model{\n#   #likelihood\n#   for(i in 1:N_obs){\n#     Y[i] ~ dbern(p[i])\n#     logit(p[i]) <- inprod(X[i,], beta[]) + alpha + alpha_location[loc[i]]\n#   }\n#   #priors\n#   for (j in 1:P) {\n#     beta[j] ~ dnorm(0, 0.01)\n#   }\n#   \n#   for (l in 1:N_locations) {\n#     alpha_location[l] ~ dnorm(0, tau)\n#   }\n#   \n#   alpha ~ dnorm(0, 0.0001)\n#   tau ~ dgamma(0.01, 0.01)\n# }\")\n# \n# model <- jags.model(model_string, data = data, n.chains = 2, )\n# update(model, 5000)\n# samples <- coda.samples(model, variable.names = c(\"alpha\", \"alpha_location\", \"beta\", \"tau\"), thin = 1, n.iter = 5000)\n# write_rds(samples, \"8b_samples.rds\")\n\nsamples <- read_rds(\"8b_samples.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples |> \n  summarise_draws() |> \n  arrange(desc(rhat)) |> \n  slice_head(n = 15) |> \n  gt() |> \n  fmt_number()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"pdtpmobwmw\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#pdtpmobwmw table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#pdtpmobwmw thead, #pdtpmobwmw tbody, #pdtpmobwmw tfoot, #pdtpmobwmw tr, #pdtpmobwmw td, #pdtpmobwmw th {\n  border-style: none;\n}\n\n#pdtpmobwmw p {\n  margin: 0;\n  padding: 0;\n}\n\n#pdtpmobwmw .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#pdtpmobwmw .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#pdtpmobwmw .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#pdtpmobwmw .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#pdtpmobwmw .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#pdtpmobwmw .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#pdtpmobwmw .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#pdtpmobwmw .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#pdtpmobwmw .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#pdtpmobwmw .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#pdtpmobwmw .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#pdtpmobwmw .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#pdtpmobwmw .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#pdtpmobwmw .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#pdtpmobwmw .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#pdtpmobwmw .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#pdtpmobwmw .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#pdtpmobwmw .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#pdtpmobwmw .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#pdtpmobwmw .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#pdtpmobwmw .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#pdtpmobwmw .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#pdtpmobwmw .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#pdtpmobwmw .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#pdtpmobwmw .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#pdtpmobwmw .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#pdtpmobwmw .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#pdtpmobwmw .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#pdtpmobwmw .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#pdtpmobwmw .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#pdtpmobwmw .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#pdtpmobwmw .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#pdtpmobwmw .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#pdtpmobwmw .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#pdtpmobwmw .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#pdtpmobwmw .gt_left {\n  text-align: left;\n}\n\n#pdtpmobwmw .gt_center {\n  text-align: center;\n}\n\n#pdtpmobwmw .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#pdtpmobwmw .gt_font_normal {\n  font-weight: normal;\n}\n\n#pdtpmobwmw .gt_font_bold {\n  font-weight: bold;\n}\n\n#pdtpmobwmw .gt_font_italic {\n  font-style: italic;\n}\n\n#pdtpmobwmw .gt_super {\n  font-size: 65%;\n}\n\n#pdtpmobwmw .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#pdtpmobwmw .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#pdtpmobwmw .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#pdtpmobwmw .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#pdtpmobwmw .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#pdtpmobwmw .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#pdtpmobwmw .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"variable\">variable</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"mean\">mean</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"median\">median</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"sd\">sd</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"mad\">mad</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"q5\">q5</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"q95\">q95</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"rhat\">rhat</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ess_bulk\">ess_bulk</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ess_tail\">ess_tail</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">beta[6]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">−0.07</td>\n<td headers=\"median\" class=\"gt_row gt_right\">−0.08</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.22</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.22</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−0.44</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">0.30</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.02</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">172.23</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">454.23</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">beta[1]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">0.48</td>\n<td headers=\"median\" class=\"gt_row gt_right\">0.49</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.22</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.21</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">0.12</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">0.85</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.02</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">172.84</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">417.75</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">alpha_location[2]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">−0.01</td>\n<td headers=\"median\" class=\"gt_row gt_right\">0.00</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.37</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.37</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−0.62</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">0.59</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.01</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">989.72</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">1,776.91</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">alpha_location[42]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">0.41</td>\n<td headers=\"median\" class=\"gt_row gt_right\">0.41</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.42</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.41</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−0.28</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">1.11</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.01</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">722.80</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">2,525.51</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">alpha_location[55]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">0.36</td>\n<td headers=\"median\" class=\"gt_row gt_right\">0.35</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.38</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.38</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−0.27</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">0.98</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.01</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">344.78</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">854.75</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">alpha_location[50]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">0.29</td>\n<td headers=\"median\" class=\"gt_row gt_right\">0.29</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.42</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.41</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−0.40</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">0.96</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.01</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">1,242.19</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">3,149.55</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">alpha_location[1]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">0.66</td>\n<td headers=\"median\" class=\"gt_row gt_right\">0.66</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.42</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.42</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−0.02</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">1.35</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.01</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">975.87</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">2,127.75</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">alpha_location[8]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">−1.03</td>\n<td headers=\"median\" class=\"gt_row gt_right\">−1.02</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.41</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.41</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−1.73</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">−0.37</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">1,401.36</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">2,207.14</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">beta[7]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">−0.21</td>\n<td headers=\"median\" class=\"gt_row gt_right\">−0.21</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.12</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.12</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−0.41</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">−0.02</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">604.25</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">1,093.46</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">alpha_location[13]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">1.24</td>\n<td headers=\"median\" class=\"gt_row gt_right\">1.23</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.48</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.48</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">0.47</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">2.05</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">521.08</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">1,463.92</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">alpha_location[56]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">0.82</td>\n<td headers=\"median\" class=\"gt_row gt_right\">0.81</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.42</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.42</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">0.13</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">1.53</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">1,598.93</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">3,065.11</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">alpha</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">−0.64</td>\n<td headers=\"median\" class=\"gt_row gt_right\">−0.64</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.12</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.12</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−0.83</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">−0.45</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">608.20</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">1,089.73</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">alpha_location[39]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">−0.43</td>\n<td headers=\"median\" class=\"gt_row gt_right\">−0.42</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.39</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.38</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−1.07</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">0.21</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">1,090.25</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">2,400.16</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">alpha_location[17]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">0.73</td>\n<td headers=\"median\" class=\"gt_row gt_right\">0.73</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.44</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.45</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">0.02</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">1.46</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">1,900.27</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">3,431.01</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">alpha_location[53]</td>\n<td headers=\"mean\" class=\"gt_row gt_right\">−0.22</td>\n<td headers=\"median\" class=\"gt_row gt_right\">−0.22</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">0.42</td>\n<td headers=\"mad\" class=\"gt_row gt_right\">0.42</td>\n<td headers=\"q5\" class=\"gt_row gt_right\">−0.92</td>\n<td headers=\"q95\" class=\"gt_row gt_right\">0.48</td>\n<td headers=\"rhat\" class=\"gt_row gt_right\">1.00</td>\n<td headers=\"ess_bulk\" class=\"gt_row gt_right\">818.92</td>\n<td headers=\"ess_tail\" class=\"gt_row gt_right\">2,555.47</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples |> \n  mcmc_trace(\n    regex_pars = c(\"beta\", \"alpha$\")\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nalpha_means <- samples |> \n  as_draws_df() |> \n  subset_draws(variable = \"alpha_location\", regex = TRUE) |> \n  summarise_draws(mean)\n\n\nplot_dat <- gambia |> \n  mutate(loc = loc) |> \n  distinct(loc, x, y) |> \n  arrange(loc) |> \n  mutate(\n    alpha = alpha_means$mean\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sf)\nlibrary(leaflet)\n\npal <- colorNumeric(\n  \"RdBu\",\n  domain = range(alpha_means$mean),\n  reverse = FALSE\n)\n\nplot_dat |> \n  st_as_sf(\n    coords = c(\"x\", \"y\"),\n    crs = \"+proj=utm +zone=28\"\n  ) |> \n  st_make_valid() |> \n  st_transform(\"WGS84\") |> \n  leaflet() |> \n  addProviderTiles(providers$OpenStreetMap) |> \n  addCircleMarkers(\n    fillColor = ~ pal(alpha),\n    weight = 0,\n    fillOpacity = 0.8,\n    radius = ~ 4 * (alpha + 2),\n    label = ~ paste(\"alpha: \", round(alpha, 3))\n  ) |> \n  addLegend(\n    \"topright\",\n    pal = pal,\n    values = ~ alpha,\n    labFormat = labelFormat(transform = function(x) sort(x, decreasing = TRUE)),\n  )\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"leaflet html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-b62049dd36def2b1473c\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-b62049dd36def2b1473c\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"addProviderTiles\",\"args\":[\"OpenStreetMap\",null,null,{\"errorTileUrl\":\"\",\"noWrap\":false,\"detectRetina\":false}]},{\"method\":\"addCircleMarkers\",\"args\":[[13.18540960275872,13.20443727199984,13.2037423480732,13.53742483375246,13.20602626703022,13.23093645511024,13.2090173879772,13.20668051663357,13.56187225369798,13.57833676738091,13.5296475443355,13.19956691943313,13.56615837917601,13.20121983480786,13.49080516225072,13.23172279328361,13.57502985259234,13.57768836934283,13.22815915832426,13.26174450040079,13.23573011986124,13.5645094425938,13.544562690998,13.4839272300477,13.58364505855119,13.59533142632986,13.64513345051705,13.66438213692903,13.60841061653907,13.59916573649856,13.61323576066644,13.54585316636497,13.53404727877061,13.53740820698451,13.46904822831206,13.49588070654694,13.47206173780209,13.49530826232973,13.53770354901038,13.43835539911058,13.34361948948074,13.40531766428903,13.43689830256806,13.37440846660204,13.38294966144942,13.37897944870888,13.30492330079484,13.28587854972034,13.27557094635405,13.41236933660916,13.33465161960916,13.40104924399798,13.30295722063481,13.29422335570695,13.47023367793146,13.37568330151961,13.43754959392746,13.34692748548696,13.35864265618051,13.56534792956765,13.32998993000308,13.41083533432287,13.33403068809915,13.54458671184575,13.33094410109701],[-16.38755103466753,-16.30543023449971,-16.28914083965627,-16.25869081794837,-16.23293684549132,-16.23041347061255,-16.21431238705679,-16.19603975208622,-16.19568557438783,-16.16088152738206,-16.13642095869955,-16.12385873694554,-16.11743240362023,-16.10971410124719,-16.09237076981781,-16.08692886664654,-16.07991433154176,-16.04584649942598,-16.04168810901558,-16.01773510686725,-16.01158288397008,-15.99879345044268,-15.98565368269467,-15.96613192806267,-15.95135065599607,-15.121762326665,-15.10813051265433,-15.06189059265774,-15.06161717065316,-15.03343830781106,-15.03169116719151,-14.97402205561854,-14.94085106711086,-14.92993283045905,-14.86422959449648,-14.85489474135969,-14.83778126548721,-14.83572534541099,-14.81674407459255,-14.78255603216664,-14.33247968917119,-14.27222850455404,-14.24083463017283,-14.21921056818505,-14.21817273092019,-14.20339476006525,-14.15707700512319,-14.12666281465122,-14.12660181855584,-14.12140619921665,-14.11188214475815,-14.08321188477724,-14.07528906357978,-14.06298246105484,-14.05150690098443,-14.03335086165948,-14.03253183613646,-14.02041399715548,-13.98087584463583,-13.97167968025913,-13.95172964019827,-13.94088763464068,-13.94069764932415,-13.89060697551229,-13.87272702640249],[10.65164866771177,7.962893756803203,8.264683645534475,8.276630200774479,7.738942003083413,7.310607295961013,11.287594381264,3.871634560657794,3.689286941386091,9.38471522921528,8.902211382397422,9.611993654248174,12.97512679868619,5.523506172525776,5.429178467044461,5.227715164141248,10.91410528652407,14.30715476008689,6.286348312974807,8.032161499294336,10.32888487977081,9.415365346291811,9.366185140138446,4.333098482311742,12.21784765476609,7.588633431890765,10.9295067042372,5.490671053283688,3.705222479535808,3.853856191996791,5.322283162616932,6.978212760492949,4.863220628291097,5.289047264443612,7.438894838294901,5.715362454251752,7.88678118184528,6.632338779691074,6.28289627497574,6.410955790730807,4.314581077184979,9.648425732888597,9.277195227465585,6.015424468693971,5.693877083624182,5.12296571330462,7.425697053378078,10.43291213768039,12.47256073458394,9.152147286698785,9.279392510489201,11.50478801440451,7.129506087290341,10.14932605946717,9.435259852057495,11.2675559934971,7.465898327253834,8.220161873188609,7.547370003247355,11.79555860437752,9.824591938668178,4.11753159842411,5.573862341737262,12.91646927681035,6.853052338908731],null,null,{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"#03F\",\"weight\":0,\"opacity\":0.5,\"fill\":true,\"fillColor\":[\"#AFD3E6\",\"#FDDCC8\",\"#FCE4D6\",\"#FCE4D6\",\"#FCD1BA\",\"#F9BB9E\",\"#87BDDA\",\"#730321\",\"#67001F\",\"#E9F0F4\",\"#F8F4F3\",\"#E1EDF3\",\"#2C71B2\",\"#CC5043\",\"#C94A40\",\"#C23E3A\",\"#9FCBE2\",\"#053061\",\"#E47F64\",\"#FDDECB\",\"#C2DDEB\",\"#E8F0F4\",\"#EAF1F5\",\"#940D26\",\"#4292C2\",\"#FBC9B0\",\"#9ECBE1\",\"#CB4E42\",\"#68001F\",\"#720221\",\"#C6443D\",\"#F5AA89\",\"#B6232E\",\"#C5413C\",\"#FAC2A6\",\"#D35B4A\",\"#FDD8C4\",\"#EE9675\",\"#E47F64\",\"#E8876A\",\"#920D26\",\"#E0ECF3\",\"#EDF2F5\",\"#DC6E57\",\"#D25949\",\"#BF3736\",\"#FAC1A5\",\"#BBDAEA\",\"#3B86BD\",\"#F2F4F6\",\"#EDF2F5\",\"#78B3D4\",\"#F7B292\",\"#CCE2EE\",\"#E8F0F4\",\"#88BEDA\",\"#FAC3A8\",\"#FCE2D4\",\"#FBC7AD\",\"#63A5CD\",\"#DAE9F2\",\"#840824\",\"#CE5245\",\"#2E74B3\",\"#F3A481\"],\"fillOpacity\":0.8},null,null,null,null,[\"alpha:  0.663\",\"alpha:  -0.009\",\"alpha:  0.066\",\"alpha:  0.069\",\"alpha:  -0.065\",\"alpha:  -0.172\",\"alpha:  0.822\",\"alpha:  -1.032\",\"alpha:  -1.078\",\"alpha:  0.346\",\"alpha:  0.226\",\"alpha:  0.403\",\"alpha:  1.244\",\"alpha:  -0.619\",\"alpha:  -0.643\",\"alpha:  -0.693\",\"alpha:  0.729\",\"alpha:  1.577\",\"alpha:  -0.428\",\"alpha:  0.008\",\"alpha:  0.582\",\"alpha:  0.354\",\"alpha:  0.342\",\"alpha:  -0.917\",\"alpha:  1.054\",\"alpha:  -0.103\",\"alpha:  0.732\",\"alpha:  -0.627\",\"alpha:  -1.074\",\"alpha:  -1.037\",\"alpha:  -0.669\",\"alpha:  -0.255\",\"alpha:  -0.784\",\"alpha:  -0.678\",\"alpha:  -0.14\",\"alpha:  -0.571\",\"alpha:  -0.028\",\"alpha:  -0.342\",\"alpha:  -0.429\",\"alpha:  -0.397\",\"alpha:  -0.921\",\"alpha:  0.412\",\"alpha:  0.319\",\"alpha:  -0.496\",\"alpha:  -0.577\",\"alpha:  -0.719\",\"alpha:  -0.144\",\"alpha:  0.608\",\"alpha:  1.118\",\"alpha:  0.288\",\"alpha:  0.32\",\"alpha:  0.876\",\"alpha:  -0.218\",\"alpha:  0.537\",\"alpha:  0.359\",\"alpha:  0.817\",\"alpha:  -0.134\",\"alpha:  0.055\",\"alpha:  -0.113\",\"alpha:  0.949\",\"alpha:  0.456\",\"alpha:  -0.971\",\"alpha:  -0.607\",\"alpha:  1.229\",\"alpha:  -0.287\"],{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]},{\"method\":\"addLegend\",\"args\":[{\"colors\":[\"#67001F , #7C0523 2.92632253404646%, #DC6D56 21.7624959932553%, #FDDDCA 40.5986694524642%, #D3E6F0 59.4348429116731%, #539BC8 78.271016370882%, #0D3F76 97.1071898300909%, #053061 \"],\"labels\":[\"1.5\",\"1.0\",\"0.5\",\"0.0\",\"-0.5\",\"-1.0\"],\"na_color\":null,\"na_label\":\"NA\",\"opacity\":0.5,\"position\":\"topright\",\"type\":\"numeric\",\"title\":\"alpha\",\"extra\":{\"p_1\":0.02926322534046464,\"p_n\":0.9710718983009088},\"layerId\":null,\"className\":\"info legend\",\"group\":null}]}],\"limits\":{\"lat\":[13.18540960275872,13.66438213692903],\"lng\":[-16.38755103466753,-13.87272702640249]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../../site_libs/htmlwidgets-1.6.2/htmlwidgets.js\"></script>\n<script src=\"../../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../../../site_libs/leaflet-1.3.1/leaflet.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/leaflet-1.3.1/leaflet.js\"></script>\n<link href=\"../../../site_libs/leafletfix-1.0.0/leafletfix.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/proj4-2.6.2/proj4.min.js\"></script>\n<script src=\"../../../site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js\"></script>\n<link href=\"../../../site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/leaflet-binding-2.2.0/leaflet.js\"></script>\n<script src=\"../../../site_libs/leaflet-providers-1.13.0/leaflet-providers_1.13.0.js\"></script>\n<script src=\"../../../site_libs/leaflet-providers-plugin-2.2.0/leaflet-providers-plugin.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}